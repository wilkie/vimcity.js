/*! vimcity - v0.1.0 - 2014-09-13 - wilkie */
!function(){function a(a){var b=a.VimCity=function(a){a=a||{},this.div=document.getElementById(a.selector.slice(1)),this.world_div=document.createElement("div"),this.world_div.setAttribute("id","vimcity-world"),this.div.appendChild(this.world_div),this.world=new b.World({width:200,height:80}),this.viewport=new b.Viewport({width:100,height:40,world:this.world,selector:"#vimcity-world"});var c=this;document.onkeydown=function(a){a=a||window.event,72==a.keyCode?c.viewport.move_left():75==a.keyCode?c.viewport.move_up():76==a.keyCode?c.viewport.move_right():74==a.keyCode&&c.viewport.move_down()};var d=new b.Building.AtmoGen,e=new b.Building.Starport,f=new b.Building.Farm;return this.world.add_building(d,3,3),this.world.destroy_building(4,4),this.world.add_building(d,3,3),this.world.add_building(e,8,4),this.world.add_building(f,18,4),this.viewport.draw(),this};b.prototype.run=function(){}}function b(a){"use strict";var b=a.VimCity;b.Building.AtmoGen=function(){b.Building.call(this,{symbol:["{blue}o{gray}|{blue}o","{gray}|{blue}o{gray}|"],name:"AtmoGen",height:2,width:3,cost:1e3,capacity:0,workers_required:30,description:"Produces Oxygen",bonuses:"Permits expantion of the city. Can store 2000 Oxygen units."})},b.Building.AtmoGen.prototype=Object.create(b.Building.prototype),b.Building.AtmoGen.prototype.constructor=b.Building.AtmoGen}function c(a){"use strict";var b=a.VimCity;b.Building.Farm=function(){b.Building.call(this,{symbol:["{magenta}~~~~{green}V{magenta}~","{magenta}~{green}V{magenta}~~~ ","{magenta}~{green}v{magenta}~~{green}V{magenta}~"],name:"Farm",height:3,width:6,cost:1e3,capacity:0,workers_required:10,description:"Produces purple grass, a desirable commodity.",bonuses:"Goods sell for 2c a worker, maximum of 20."})},b.Building.Farm.prototype=Object.create(b.Building.prototype),b.Building.Farm.prototype.constructor=b.Building.Farm}function d(a){"use strict";var b=a.VimCity;b.Building=function(a){this.symbol=a.symbol,this.name=a.name,this.height=a.height,this.width=a.width,this.cost=a.cost,this.capacity=a.capacity,this.workers_required=a.workers_required,this.description=a.description,this.bonuses=a.bonuses;var b=0,c=0,d="white";this.symbol_color=new Array(this.height),this.symbol_char=new Array(this.height);for(var e=0;e<this.height;e++){this.symbol_color[e]=new Array(this.width),this.symbol_char[e]=new Array(this.width);for(var f=0;f<this.width;f++){for(;"{"==a.symbol[b][c];){var g=a.symbol[b].indexOf("}",c);d=a.symbol[b].substring(c+1,g),c=g+1}this.symbol_color[e][f]=d,this.symbol_char[e][f]=a.symbol[b][c],c++}c=0,b++}},b.Building.prototype.add_to_city=function(a){a.coins-=this.cost,a.population_cap+=this.capacity,a.free_workers-=self.workers_required,a.buildings[this.name]+=1},b.Building.prototype.remove_from_city=function(a){a.buildings[this.name]-=1,a.coins+=this.cost,a.population_cap-=this.capacity,a.free_workers+=self.workers_required}}function e(a){"use strict";var b=a.VimCity;b.Building.Seitch=function(){b.Building.call(this,{symbol:["H"],name:"Seitch",height:1,width:1,cost:100,capacity:10,workers_required:0,description:"A simple House",bonuses:"none"})},b.Building.Seitch.prototype=Object.create(b.Building.prototype),b.Building.Seitch.prototype.constructor=b.Building.Seitch}function f(a){"use strict";var b=a.VimCity;b.Building.Starport=function(){b.Building.call(this,{symbol:["\\ /"," {red}={white} ","/ \\"],name:"Starport",height:3,width:3,cost:2e3,capacity:0,workers_required:20,description:"Allows for interstellar travel",bonuses:"Boosts your city's population"})},b.Building.Starport.prototype=Object.create(b.Building.prototype),b.Building.Starport.prototype.constructor=b.Building.Starport}function g(a){"use strict";var b=a.VimCity;b.OUT_BOUNDS_CHAR="x",b.EMPTY_CHAR=" ",b.GRID_CHAR=".",b.GRID_COLOR="#880000",b.GRID_WIDTH=4,b.GRID_HEIGHT=2}function h(a){"use strict";var b=a.VimCity;b.Viewport=function(a){this.width=a.width||100,this.height=a.height||40,this.selector=a.selector,this.world=a.world,this.y=a.y||0,this.x=a.x||0,this.world_div=document.getElementById(this.selector.slice(1)),this.grid=new Array(this.height);for(var b=0;b<this.height;b++){var c=document.createElement("div");c.className="vimcity-world-row vimcity-world-row-"+b,this.world_div.appendChild(c),this.grid[b]=new Array(this.width);for(var d=0;d<this.width;d++){var e=document.createElement("div");e.className="vimcity-world-tile vimcity-world-tile-"+b+"-"+d,e.style.fontFamily="'Courier', monospace",e.style.fontSize="12px",e.style.width="10px",e.style.height="16px",e.style.backgroundColor="black",e.style.display="inline-block",e.style.color="white",e.style.verticalAlign="top",e.style.lineHeight="16px",e.style.cursor="default",c.appendChild(e),this.grid[b][d]=e}}},b.Viewport.prototype.move=function(a,b){0>a&&(a=0),0>b&&(b=0),b+this.width>this.world.width&&(b=this.world.width-this.width),a+this.height>this.world.height&&(a=this.world.height-this.height),this.y=a,this.x=b,this.draw()},b.Viewport.prototype.move_up=function(){this.move(this.y-1,this.x)},b.Viewport.prototype.move_down=function(){this.move(this.y+1,this.x)},b.Viewport.prototype.move_left=function(){this.move(this.y,this.x-2)},b.Viewport.prototype.move_right=function(){this.move(this.y,this.x+2)},b.Viewport.prototype.draw=function(){for(var a=0;a<this.height;a++)for(var c=0;c<this.width;c++){var d=a+this.y,e=c+this.x;if(d>=this.world.height||e>=this.world.width||0>d||0>e)this.grid[a][c].style.color="red",this.grid[a][c].innerHTML=b.OUT_BOUNDS_CHAR;else{var f=this.world.grid[d][e];""==f.chr?(this.grid[a][c].style.color=b.GRID_COLOR,this.grid[a][c].innerHTML=d%b.GRID_HEIGHT==0&&e%b.GRID_WIDTH==0?b.GRID_CHAR:b.EMPTY_CHAR):(this.grid[a][c].style.color=f.color,this.grid[a][c].innerHTML=f.chr)}}}}function i(a){"use strict";var b=a.VimCity;b.World=function(a){this.width=a.width,this.height=a.height,this.grid=new Array(this.height),this.building_map=new Array(this.height);for(var b=0;b<this.height;b++){this.building_map[b]=new Array(this.width),this.grid[b]=new Array(this.width);for(var c=0;c<this.width;c++)this.building_map[b][c]=[0,0,null],this.grid[b][c]={color:"white",chr:""}}},b.World.prototype.can_build=function(a,b,c){if(b+a.height>this.height)return!1;if(c+a.width>this.width)return!1;for(var d=b;d<b+a.height;d++)for(var e=c;e<c+a.width;e++)if(null!==this.building_map[d][e][2])return!1;return!0},b.World.prototype.add_building=function(a,b,c){if(this.can_build(a,b,c))for(var d=b;d<this.height&&d<b+a.height;d++)for(var e=c;e<this.width&&e<c+a.width;e++)this.grid[d][e]={color:a.symbol_color[d-b][e-c],chr:a.symbol_char[d-b][e-c]},this.building_map[d][e]=[b,c,a]},b.World.prototype.destroy_building=function(a,b){var c=this.building_map[a][b];if(null!==c[2]){a=c[0],b=c[1];for(var d=c[2],e=a;e<this.height&&e<a+d.height;e++)for(var f=b;f<this.width&&f<b+d.width;f++)this.grid[e][f]={color:"white",chr:""},this.building_map[e][f]=[0,0,null]}}}var j=function(j){return a(j),g(j),h(j),i(j),d(j),b(j),c(j),f(j),e(j),j.VimCity};"function"==typeof define&&define.amd?define(function(){return j({})}):j(this)}(this);